# AGENTS.md
# Repository guidance for agentic contributors

## Scope
- This repo contains a SystemVerilog RTL module in `rtl/` and a C++ harness in `cpu_2601.cpp`.
- `builddir/` contains Verilator-generated artifacts. Treat it as generated output.
- There are no existing Cursor or Copilot rules in this repository.

## Build, Lint, Test Commands

### Build System (Preferred)
Use the repo build script at the root. It wraps Verilator and produces the simulation executable.

Build:
- `./build build`

Clean:
- `./build clean`

Notes:
- Output executable: `builddir/cpu_2601`.
- The script accepts optional overrides for Verilator root and toolchain binaries. See `build` for argument order.
- Keep generated outputs in `builddir/` only.

### Manual Verilator (Fallback)
Only use direct Verilator commands if the build script cannot be used.
- `verilator --cc rtl/cpu_2601.sv --exe cpu_2601.cpp --Mdir builddir`
- `make -C builddir -f Vcpu_2601.mk`

### Lint
There is no repository-wide lint config. Use Verilator lint for RTL:
- `verilator --lint-only -Wall rtl/cpu_2601.sv`

### Tests
There is no test framework or testbench in this repo.
- The C++ harness in `cpu_2601.cpp` serves as the only simulation driver.
- Single-test command: not applicable (document one if tests are added).

## Project Layout
- `rtl/` : SystemVerilog source code
- `cpu_2601.cpp` : C++ simulation harness
- `builddir/` : Verilator outputs (generated)

## Generated Artifacts (Do Not Edit)
- All files under `builddir/` are generated by Verilator.
- Do not hand-edit files like `Vcpu_2601.mk`, `Vcpu_2601*.cpp`, or `Vcpu_2601*.h`.
- Regenerate instead of editing generated files.

## SystemVerilog Style Guidelines

### General
- Use `logic` for signals unless a specific net type is required.
- Prefer explicit module ports and named port connections.
- Avoid implicit nets (no undeclared wires).
- Keep one primary module per file.
- Prefer `always_ff`/`always_comb` over `always` when applicable.
- Keep combinational logic free of latches; use defaults in `always_comb`.

### Formatting
- Indentation: 4 spaces in `rtl/cpu_2601.sv`.
- Align port lists vertically when they grow beyond a few lines.
- Keep blank lines between logical sections (ports, declarations, always blocks).
- Use trailing commas in multi-line port lists for easier diffs.

### Naming
- Module names: `snake_case` to match `cpu_2601`.
- Signals: `snake_case` with suffixes like `_n` for active-low signals.
- Parameters: `UPPER_SNAKE_CASE`.
- Localparams: `UPPER_SNAKE_CASE`.
- Use `_d`/`_q` suffixes for registered signals when helpful.

### Resets and Clocks
- Use clear names like `clk` and `rst` for top-level signals.
- If using active-low reset, name it `rst_n` and document behavior.

### Verilator Pragmas
- Use `/* verilator lint_off ... */` sparingly and only around known false positives.
- Re-enable lint with `/* verilator lint_on ... */` immediately after the block.

## C++ Style Guidelines (Simulation Harness)

### General
- Keep the harness minimal and deterministic.
- The harness currently toggles `clk` and calls `eval()` in a loop.
- Use `Verilated::commandArgs(argc, argv);` at startup.
- Avoid hidden global state; keep all simulation state in `main`.
- Prefer explicit time/step counters when adding cycle-based checks.

### Includes
- Include the generated model header first, then `verilated.h`:
  - `#include "Vcpu_2601.h"`
  - `#include "verilated.h"`
- Keep includes minimal; add only what the harness uses.

### Formatting
- Indentation: 2 spaces in `cpu_2601.cpp`.
- Braces on the same line as the statement.
- Prefer early returns for simple error handling.

### Ownership
- Allocate the model with `new` and free with `delete`.
- Avoid global state; keep simulation state in `main` or a small helper.
- If you add helpers, keep them in the same file unless they grow beyond scope.

## Error Handling
- Fail fast in the harness if required arguments are missing.
- Avoid empty catch blocks. Prefer explicit error messages.
- Print errors to stderr and return non-zero exit codes.

## Adding New Files
- Add new RTL files under `rtl/`.
- Update the `build` script to pass additional RTL sources to Verilator.
- Keep generated files in `builddir/` only.

## Suggestions for Future Expansion
- Add a testbench directory (e.g., `tb/`) and document single-test commands.
- Consider a simple `Makefile` at repo root to wrap Verilator commands.

## Quick Start (Typical Flow)
1. Edit `rtl/cpu_2601.sv`.
2. Build with the repo script:
   - `./build build`
3. Run the simulation executable:
   - `./builddir/cpu_2601`
